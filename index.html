<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ZENITH ‚Äî The Photographer's Lens</title>
<style>
    /* --- CSS for Zenith --- */
    :root {
        --bg: #111;
        --fg: #eaf0ff;
        --accent: #ff4d6d;
        --muted: #9aacbf;
        --rim: #2a2a2a;
        --meter-fill: #00e5ff;
        --glow: 0 0 10px rgba(255, 77, 109, 0.5);
    }
    
    @keyframes pulse { 0%,100%{opacity:.7} 50%{opacity:1} }
    @keyframes flicker { 0%,98%,100%{opacity:1} 99%{opacity:.8} }
    
    * { box-sizing: border-box; font-family: 'JetBrains Mono', Consolas, Monaco, monospace; }
    body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
    }
    
    header {
        padding: 16px 20px;
        border-bottom: 2px solid var(--rim);
        background: linear-gradient(180deg, rgba(42,42,42,0.8), rgba(15,15,15,0.9));
        backdrop-filter: blur(10px);
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    header h1 {
        font-size: 1.2rem;
        margin: 0;
        color: var(--accent);
        letter-spacing: 1px;
        text-shadow: 0 0 10px var(--accent);
        animation: flicker 3s infinite;
    }
    .tag {
        border: 1px solid var(--rim);
        border-radius: 12px;
        padding: 8px 12px;
        background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
        color: var(--muted);
        box-shadow: inset 0 1px 2px rgba(255,255,255,0.1);
    }
    
    main {
        flex: 1;
        display: grid;
        place-items: center;
        padding: 20px;
        position: relative;
    }
    
    .stage {
        position: relative;
        width: min(95vw, 1400px);
        aspect-ratio: 16/9;
        border: 2px solid var(--rim);
        border-radius: 20px;
        overflow: hidden;
        background: #000;
        box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 50px rgba(0,0,0,0.8);
    }
    video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    canvas#paint {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .hud {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 10;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
    }
    
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
    }
    .badge {
        pointer-events: auto;
        border: 1px solid var(--rim);
        background: rgba(10,10,10,.85);
        backdrop-filter: blur(15px);
        padding: 8px 14px;
        border-radius: 12px;
        font-family: inherit;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
    }
    .badge strong { color: var(--accent); font-weight: 700; }
    
    #recLamp {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        font-size: 1.1rem;
    }
    .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: transparent;
        border: 2px solid rgba(255,255,255,.4);
        transition: all 0.3s ease;
    }
    .rec.live .dot {
        background: var(--accent);
        border-color: var(--accent);
        box-shadow: var(--glow);
        animation: pulse 2s ease-in-out infinite;
    }
    
    .control-panel {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
    }
    .control-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .control-group label {
        color: var(--muted);
        font-size: 0.8rem;
        text-transform: uppercase;
    }
    input[type=range] {
        -webkit-appearance: none;
        width: 100px;
        height: 6px;
        background: var(--rim);
        border-radius: 3px;
    }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
    }
    
    /* Live Analytics Displays */
    .analytics-display {
        background: rgba(0,0,0,0.6);
        border: 1px solid var(--rim);
        border-radius: 10px;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    .analytics-display > span {
        font-size: 0.7rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    #hist, #waveform {
        width: 180px;
        height: 60px;
    }

    .controls {
        margin-top: 25px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
        padding: 20px;
        border-radius: 15px;
        background: rgba(30,42,69,0.3);
        backdrop-filter: blur(10px);
        border: 1px solid var(--rim);
    }
    button {
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: 1px solid var(--rim);
        border-radius: 12px;
        padding: 8px 14px;
        background: linear-gradient(145deg, #1a1a1a, #0e0e0e);
        color: var(--fg);
    }
    button.primary {
        border-color: var(--accent);
        color: var(--accent);
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
</style>
</head>
<body>

<header>
    <h1>ZENITH ‚Äî The Photographer's Lens</h1>
    <span class="tag">Manual Control</span>
    <span class="tag">Live Analytics</span>
    <span class="tag">Creator-Driven</span>
</header>

<main>
    <div class="stage">
        <video id="vf" playsinline autoplay muted></video>
        <canvas id="paint"></canvas>

        <div class="hud">
            <div class="top-bar">
                <div id="recLamp" class="rec">
                    <div class="dot"></div><span id="recTimer">00:00:00</span>
                </div>
                <div class="control-panel">
                    <div class="control-group">
                        <label for="iso-slider">ISO</label>
                        <input type="range" id="iso-slider" min="100" max="6400" step="100" value="400">
                        <span id="iso-value">400</span>
                    </div>
                    <div class="control-group">
                        <label for="shutter-slider">Shutter</label>
                        <input type="range" id="shutter-slider" min="1" max="1000" step="1" value="60">
                        <span id="shutter-value">1/60s</span>
                    </div>
                    <div class="control-group">
                        <label for="wb-slider">WB</label>
                        <input type="range" id="wb-slider" min="2000" max="10000" step="100" value="5500">
                        <span id="wb-value">5500K</span>
                    </div>
                </div>
                <div class="analytics-display">
                    <span>HISTOGRAM</span>
                    <canvas id="hist"></canvas>
                </div>
            </div>
            
            <div class="bottom-bar">
                <div class="analytics-display">
                    <span>WAVEFORM</span>
                    <canvas id="waveform"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button id="start-btn" class="primary">üé• Initialize Camera</button>
        <button id="snap-btn">üì∏ Capture Still</button>
        <button id="rec-btn">‚è∫Ô∏è Start Recording</button>
        <button id="dl-btn" disabled>üíæ Download Last</button>
    </div>
</main>

<footer>
    Zenith is built for photographers and filmmakers who demand total creative control.
</footer>

<script>
(async function(){
    const vf = document.getElementById('vf');
    const paint = document.getElementById('paint');
    const pctx = paint.getContext('2d', { willReadFrequently: true });
    
    const hist = document.getElementById('hist');
    const hctx = hist.getContext('2d');
    const waveform = document.getElementById('waveform');
    const wctx = waveform.getContext('2d');

    const isoSlider = document.getElementById('iso-slider');
    const shutterSlider = document.getElementById('shutter-slider');
    const wbSlider = document.getElementById('wb-slider');
    
    const isoValue = document.getElementById('iso-value');
    const shutterValue = document.getElementById('shutter-value');
    const wbValue = document.getElementById('wb-value');

    const startBtn = document.getElementById('start-btn');
    const snapBtn = document.getElementById('snap-btn');
    const recBtn = document.getElementById('rec-btn');
    const dlBtn = document.getElementById('dl-btn');
    
    let stream = null;
    let rafId = null;
    let mediaRec = null;
    let chunks = [];
    let lastBlob = null;
    let recTimerInterval = null;
    let recordingStartTime = null;

    // --- Core Logic Functions ---
    async function startCamera() {
        if (stream) stopCamera();
        try {
            const constraints = { video: { facingMode: 'environment' } };
            stream = await navigator.mediaDevices.getUserMedia(constraints);
            vf.srcObject = stream;
            await vf.play();
            
            // Set up canvases based on video dimensions
            const dpr = window.devicePixelRatio || 1;
            paint.width = vf.videoWidth * dpr;
            paint.height = vf.videoHeight * dpr;
            paint.style.width = vf.videoWidth + 'px';
            paint.style.height = vf.videoHeight + 'px';
            pctx.scale(dpr, dpr);

            hist.width = 180 * dpr; hist.height = 60 * dpr;
            hctx.scale(dpr, dpr);
            waveform.width = 180 * dpr; waveform.height = 60 * dpr;
            wctx.scale(dpr, dpr);

            loop();
        } catch(e) {
            alert('Camera unavailable or permission denied.');
        }
    }

    function stopCamera() {
        if (rafId) cancelAnimationFrame(rafId);
        if (stream) stream.getTracks().forEach(t => t.stop());
        stream = null;
    }

    function loop() {
        rafId = requestAnimationFrame(loop);
        
        // Draw frame to canvas
        pctx.drawImage(vf, 0, 0, vf.videoWidth, vf.videoHeight);
        
        // Get pixel data for analysis
        const imageData = pctx.getImageData(0, 0, vf.videoWidth, vf.videoHeight);
        const data = imageData.data;
        
        // --- Manual Control Effects ---
        const iso = parseFloat(isoSlider.value);
        const shutterSpeed = 1 / parseFloat(shutterSlider.value);
        const wb = parseInt(wbSlider.value);

        // Simple exposure simulation
        const exposureFactor = (iso / 400) * (shutterSpeed / (1/60));

        // Simple white balance adjustment
        const wbFactor = (wb - 5500) / 1000;

        for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, data[i] * exposureFactor);
            data[i+1] = Math.min(255, data[i+1] * exposureFactor);
            data[i+2] = Math.min(255, data[i+2] * exposureFactor);
            // Apply WB shift
            if (wbFactor > 0) {
                 data[i] = Math.min(255, data[i] * (1 + wbFactor));
            } else {
                 data[i+2] = Math.min(255, data[i+2] * (1 + -wbFactor));
            }
        }
        pctx.putImageData(imageData, 0, 0);

        // --- Live Analytics ---
        drawHistogram(data);
        drawWaveform(data, vf.videoWidth);
    }
    
    // --- Analytics Rendering ---
    function drawHistogram(data) {
        const w = 180, h = 60;
        hctx.clearRect(0, 0, w, h);
        const histogram = new Uint32Array(256).fill(0);
        
        for (let i = 0; i < data.length; i += 4) {
            const luma = Math.round(0.299*data[i] + 0.587*data[i+1] + 0.114*data[i+2]);
            histogram[luma]++;
        }
        
        const max = Math.max(...histogram) || 1;
        const barWidth = w / 256;
        hctx.fillStyle = 'rgba(255,255,255,0.5)';
        for (let i = 0; i < 256; i++) {
            const barHeight = (histogram[i] / max) * h;
            hctx.fillRect(i * barWidth, h - barHeight, Math.max(1, barWidth - 0.5), barHeight);
        }
    }

    function drawWaveform(data, width) {
        const w = 180, h = 60;
        wctx.clearRect(0, 0, w, h);
        const sampleCount = 100;
        wctx.strokeStyle = '#00e5ff';
        wctx.lineWidth = 1;
        wctx.beginPath();
        
        for (let i = 0; i < sampleCount; i++) {
            const pixelIndex = Math.floor((i / sampleCount) * data.length);
            const luma = Math.round(0.299*data[pixelIndex] + 0.587*data[pixelIndex+1] + 0.114*data[pixelIndex+2]);
            const x = (i / sampleCount) * w;
            const y = h - (luma / 255) * h;
            if (i === 0) wctx.moveTo(x, y);
            else wctx.lineTo(x, y);
        }
        wctx.stroke();
    }
    
    // --- Capture & Recording ---
    function captureStill() {
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = vf.videoWidth;
        tempCanvas.height = vf.videoHeight;
        const ctx = tempCanvas.getContext('2d');
        ctx.drawImage(vf, 0, 0, tempCanvas.width, tempCanvas.height);
        
        const a = document.createElement('a');
        a.download = `Zenith_Still_${Date.now()}.png`;
        a.href = tempCanvas.toDataURL('image/png');
        a.click();
    }
    
    function startRecording() {
        if (!stream) return;
        const captureStream = paint.captureStream(60);
        mediaRec = new MediaRecorder(captureStream);
        chunks = [];
        
        mediaRec.ondataavailable = e => e.data.size && chunks.push(e.data);
        mediaRec.onstop = () => {
            lastBlob = new Blob(chunks, { type: 'video/webm' });
            dlBtn.disabled = false;
        };
        
        mediaRec.start(1000);
        document.getElementById('recLamp').classList.add('live');
        recBtn.textContent = '‚èπÔ∏è Stop Recording';
        recordingStartTime = Date.now();
        recTimerInterval = setInterval(updateTimer, 1000);
    }
    
    function stopRecording() {
        if (mediaRec && mediaRec.state !== 'inactive') mediaRec.stop();
        document.getElementById('recLamp').classList.remove('live');
        recBtn.textContent = '‚è∫Ô∏è Start Recording';
        clearInterval(recTimerInterval);
        document.getElementById('recTimer').textContent = '00:00:00';
    }
    
    function updateTimer() {
        const t = Date.now() - recordingStartTime;
        const hours = Math.floor(t / 3600000);
        const minutes = Math.floor((t % 3600000) / 60000);
        const seconds = Math.floor((t % 60000) / 1000);
        document.getElementById('recTimer').textContent = `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
    }
    
    function downloadLast() {
        if (!lastBlob) return;
        const a = document.createElement('a');
        a.download = `Zenith_Video_${Date.now()}.webm`;
        a.href = URL.createObjectURL(lastBlob);
        a.click();
    }
    
    // --- Event Listeners ---
    startBtn.addEventListener('click', startCamera);
    snapBtn.addEventListener('click', captureStill);
    dlBtn.addEventListener('click', downloadLast);
    
    recBtn.addEventListener('click', () => {
        if (!mediaRec || mediaRec.state === 'inactive') {
            startRecording();
        } else {
            stopRecording();
        }
    });

    isoSlider.addEventListener('input', () => isoValue.textContent = isoSlider.value);
    shutterSlider.addEventListener('input', () => shutterValue.textContent = `1/${shutterSlider.value}s`);
    wbSlider.addEventListener('input', () => wbValue.textContent = `${wbSlider.value}K`);
})();
</script>
</body>
</html>
